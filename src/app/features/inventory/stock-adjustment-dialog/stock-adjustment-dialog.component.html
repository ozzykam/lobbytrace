<div class="stock-adjustment-dialog">
  <div mat-dialog-title class="dialog-header">
    <div class="header-content">
      <mat-icon class="header-icon">inventory</mat-icon>
      <div class="header-text">
        <h2>Adjust Stock Level</h2>
        <span class="item-name">{{ item.name }}</span>
      </div>
    </div>
    <button mat-icon-button (click)="onCancel()" [disabled]="isSubmitting()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- Current Stock Info -->
    <mat-card class="stock-info-card">
      <mat-card-content>
        <div class="stock-info-grid">
          <div class="stock-info-item">
            <span class="label">Current Stock</span>
            <span class="value current-stock">{{ item.currentPhysicalStock }} {{ item.physicalUnit }}</span>
          </div>
          <div class="stock-info-item">
            <span class="label">Min Stock Level</span>
            <span class="value">{{ item.minPhysicalStockLevel }} {{ item.physicalUnit }}</span>
          </div>
          <div class="stock-info-item">
            <span class="label">Recipe Units Available</span>
            <span class="value">{{ item.currentPhysicalStock * item.unitsPerPhysicalItem }} {{ item.recipeUnit }}</span>
          </div>
          <div class="stock-info-item">
            <span class="label">Current Value</span>
            <span class="value">{{ formatCurrency(item.currentPhysicalStock * item.costPerPhysicalUnit) }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Adjustment Form -->
    <form [formGroup]="adjustmentForm" (ngSubmit)="onSubmit()" class="adjustment-form">
      <!-- Movement Type -->
      <mat-form-field  class="full-width">
        <mat-label>Movement Type</mat-label>
        <mat-select formControlName="movementType">
          <mat-option *ngFor="let type of movementTypes" [value]="type.value">
            <div class="movement-type-option">
              <span class="type-label">{{ type.label }}</span>
              <span class="type-description">{{ type.description }}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-hint>{{ movementTypeDescription }}</mat-hint>
      </mat-form-field>

      <!-- Quantity -->
      <mat-form-field class="full-width">
        <mat-label>Quantity</mat-label>
        <input matInput 
               type="number" 
               step="0.1" 
               min="0.01"
               formControlName="quantity"
               [placeholder]="item.physicalUnit">
        <span matSuffix>{{ item.physicalUnit }}</span>
        <mat-error *ngIf="adjustmentForm.get('quantity')?.hasError('required')">
          Quantity is required
        </mat-error>
        <mat-error *ngIf="adjustmentForm.get('quantity')?.hasError('min')">
          Quantity must be greater than 0
        </mat-error>
      </mat-form-field>

      <!-- Reason -->
      <mat-form-field class="full-width">
        <mat-label>Reason</mat-label>
        <mat-select formControlName="reason">
          <mat-option *ngFor="let reason of availableReasons" [value]="reason">
            {{ reason }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="adjustmentForm.get('reason')?.hasError('required')">
          Please select a reason
        </mat-error>
      </mat-form-field>

      <!-- Notes -->
      <mat-form-field class="full-width">
        <mat-label>Notes (Optional)</mat-label>
        <textarea matInput 
                  formControlName="notes" 
                  rows="3" 
                  placeholder="Additional details about this stock adjustment..."></textarea>
      </mat-form-field>
    </form>

    <mat-divider></mat-divider>

    <!-- Preview -->
    <div class="adjustment-preview" *ngIf="adjustmentForm.valid">
      <h3>Adjustment Preview</h3>
      <div class="preview-grid">
        <div class="preview-item">
          <span class="label">Current Stock</span>
          <span class="value">{{ item.currentPhysicalStock }} {{ item.physicalUnit }}</span>
        </div>
        <div class="preview-item">
          <span class="label">After Adjustment</span>
          <span class="value" [ngClass]="stockChangeColor">{{ previewNewStock }} {{ item.physicalUnit }}</span>
        </div>
        <div class="preview-item">
          <span class="label">Change</span>
          <span class="value" [ngClass]="stockChangeColor">
            {{ previewNewStock > item.currentPhysicalStock ? '+' : '' }}{{ previewNewStock - item.currentPhysicalStock }} {{ item.physicalUnit }}
          </span>
        </div>
        <div class="preview-item" *ngIf="calculateValueImpact() !== 0">
          <span class="label">Value Impact</span>
          <span class="value" [ngClass]="stockChangeColor">
            {{ calculateValueImpact() > 0 ? '+' : '' }}{{ formatCurrency(calculateValueImpact()) }}
          </span>
        </div>
      </div>

      <!-- Stock Level Warning -->
      <div class="stock-warning" *ngIf="previewNewStock <= item.minPhysicalStockLevel">
        <mat-icon color="warn">warning</mat-icon>
        <span>This adjustment will result in low stock (at or below minimum level)</span>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-button 
            type="button" 
            (click)="onCancel()" 
            [disabled]="isSubmitting()">
      Cancel
    </button>
    <button mat-raised-button 
            color="primary"
            (click)="onSubmit()"
            [disabled]="adjustmentForm.invalid || isSubmitting()">
      <mat-icon *ngIf="isSubmitting()">hourglass_empty</mat-icon>
      <mat-icon *ngIf="!isSubmitting()">check</mat-icon>
      {{ isSubmitting() ? 'Updating...' : 'Update Stock' }}
    </button>
  </mat-dialog-actions>
</div>