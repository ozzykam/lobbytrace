<form [formGroup]="inventoryForm" (ngSubmit)="onSubmit()" class="dialog-container">
  
  <!-- Dialog Header -->
  <div mat-dialog-title class="dialog-header">
    <mat-icon color="primary">{{ mode === 'create' ? 'add_circle' : 'edit' }}</mat-icon>
    <span>{{ mode === 'create' ? 'Add New Inventory Item' : 'Edit Inventory Item' }}</span>
  </div>

  <!-- Dialog Content -->
  <div mat-dialog-content class="dialog-content">
    
    <!-- Basic Information -->
    <div class="form-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Basic Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="form-row">
            <mat-form-field>
              <mat-label>Item Name *</mat-label>
              <input 
                matInput 
                formControlName="name"
                placeholder="e.g., Ground Coffee, Paper Cups">
              @if (isFieldInvalid('name')) {
                <mat-error>{{getFieldError('name')}}</mat-error>
              }
            </mat-form-field>

            <mat-form-field>
              <mat-label>Category *</mat-label>
              <mat-select formControlName="category">
                @for (category of categories; track category) {
                  <mat-option [value]="category">{{category}}</mat-option>
                }
              </mat-select>
              @if (isFieldInvalid('category')) {
                <mat-error>{{getFieldError('category')}}</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field>
              <mat-label>Unit of Measurement *</mat-label>
              <mat-select formControlName="unit">
                @for (unit of units; track unit) {
                  <mat-option [value]="unit">{{unit}}</mat-option>
                }
              </mat-select>
              @if (isFieldInvalid('unit')) {
                <mat-error>{{getFieldError('unit')}}</mat-error>
              }
            </mat-form-field>

            <mat-form-field>
              <mat-label>Supplier</mat-label>
              <input 
                matInput 
                formControlName="supplier"
                placeholder="e.g., Local Coffee Roasters">
              @if (isFieldInvalid('supplier')) {
                <mat-error>{{getFieldError('supplier')}}</mat-error>
              }
            </mat-form-field>
          </div>

          <mat-form-field class="form-field-full">
            <mat-label>Description</mat-label>
            <textarea 
              matInput 
              formControlName="description"
              placeholder="Optional description of the inventory item"
              rows="3">
            </textarea>
            @if (isFieldInvalid('description')) {
              <mat-error>{{getFieldError('description')}}</mat-error>
            }
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Stock Information -->
    <div class="form-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>inventory</mat-icon>
            Stock Information
          </mat-card-title>
          <mat-card-subtitle>
            Set current stock levels and thresholds
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="form-row">
            <mat-form-field>
              <mat-label>Current Stock *</mat-label>
              <input 
                matInput 
                type="number"
                step="0.1"
                min="0"
                formControlName="currentStock"
                placeholder="0"
                matTooltip="How much of this item is currently in stock"
                matTooltipPosition="above">
              <span matSuffix>{{inventoryForm.get('unit')?.value || 'units'}}</span>
              @if (isFieldInvalid('currentStock')) {
                <mat-error>{{getFieldError('currentStock')}}</mat-error>
              }
            </mat-form-field>

            <mat-form-field>
              <mat-label>Minimum Stock Level *</mat-label>
              <input 
                matInput 
                type="number"
                step="0.1"
                min="0"
                formControlName="minStockLevel"
                placeholder="0"
                matTooltip="Alert when stock falls below this level"
                matTooltipPosition="above">
              <span matSuffix>{{inventoryForm.get('unit')?.value || 'units'}}</span>
              @if (isFieldInvalid('minStockLevel')) {
                <mat-error>{{getFieldError('minStockLevel')}}</mat-error>
              }
            </mat-form-field>

            <mat-form-field>
              <mat-label>Maximum Stock Level</mat-label>
              <input 
                matInput 
                type="number"
                step="0.1"
                min="0"
                formControlName="maxStockLevel"
                placeholder="Optional"
                matTooltip="Optional maximum capacity for inventory management"
                matTooltipPosition="above">
              <span matSuffix>{{inventoryForm.get('unit')?.value || 'units'}}</span>
              @if (isFieldInvalid('maxStockLevel')) {
                <mat-error>{{getFieldError('maxStockLevel')}}</mat-error>
              }
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Cost Information -->
    <div class="form-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            Cost Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="form-row">
            <mat-form-field>
              <mat-label>Cost Per Unit *</mat-label>
              <input 
                matInput 
                type="number"
                step="0.01"
                min="0"
                formControlName="costPerUnit"
                placeholder="0.00"
                matTooltip="How much each unit costs to purchase or produce"
                matTooltipPosition="above">
              <span matPrefix>$</span>
              <span matSuffix>per {{inventoryForm.get('unit')?.value || 'unit'}}</span>
              @if (isFieldInvalid('costPerUnit')) {
                <mat-error>{{getFieldError('costPerUnit')}}</mat-error>
              }
            </mat-form-field>

            <div class="value-display">
              <div class="value-display-header">
                <mat-icon>calculate</mat-icon>
                <span>Total Inventory Value</span>
              </div>
              <div class="value-display-amount">
                {{calculateTotalValue() | currency:'USD':'symbol':'1.2-2'}}
              </div>
              <div class="value-display-label">
                Current Stock Ã— Cost Per Unit
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Stock Status Preview -->
    <div class="form-section">
      <div class="status-preview">
        <div class="status-preview-content">
          <div>
            <mat-icon>info</mat-icon>
            <span>Stock Status Preview:</span>
          </div>
          
          @if (inventoryForm.get('currentStock')?.value <= inventoryForm.get('minStockLevel')?.value) {
            <span class="status-badge low-stock">
              <mat-icon>warning</mat-icon>
              Low Stock
            </span>
          } @else if (inventoryForm.get('maxStockLevel')?.value && inventoryForm.get('currentStock')?.value >= inventoryForm.get('maxStockLevel')?.value) {
            <span class="status-badge high-stock">
              Overstocked
            </span>
          } @else {
            <span class="status-badge normal-stock">
              Normal Stock
            </span>
          }
        </div>
      </div>
    </div>
    
  </div>

  <!-- Dialog Actions -->
  <div mat-dialog-actions class="dialog-actions">
    <button 
      type="button"
      mat-button 
      (click)="onCancel()"
      [disabled]="isLoading()">
      Cancel
    </button>
    
    <button 
      type="submit"
      mat-raised-button 
      color="primary"
      [disabled]="inventoryForm.invalid || isLoading()">
      @if (isLoading()) {
        <mat-spinner diameter="20"></mat-spinner>
      } @else {
        <mat-icon>{{ mode === 'create' ? 'add' : 'save' }}</mat-icon>
      }
      {{ mode === 'create' ? 'Add Item' : 'Save Changes' }}
    </button>
  </div>

</form>