<div class="dialog-container">
  <!-- Dialog Header -->
  <div mat-dialog-title class="dialog-header">
    <mat-icon color="primary">cloud_upload</mat-icon>
    <span>Import Inventory from CSV</span>
  </div>

  <!-- Dialog Content -->
  <div mat-dialog-content class="dialog-content">
    
    @if (!csvData().length && !isImporting()) {
      <!-- File Upload Section -->
      <div class="upload-section">
        <div class="upload-area" 
             [class.drag-over]="isDragOver()"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)"
             (click)="fileInput.click()">
          
          <input #fileInput
                 type="file"
                 accept=".csv"
                 (change)="onFileSelected($event)"
                 style="display: none;">
          
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <h3>Select CSV File</h3>
          <p>Drag and drop your inventory CSV file here, or click to browse</p>
          <p class="file-info">Supported format: .csv files only</p>
        </div>
      </div>

      <!-- Instructions -->
      <div class="instructions">
        <h4>CSV Format Requirements:</h4>
        <ul>
          <li>File must include headers: CommonName, Vendor, ItemCategory, etc.</li>
          <li>CommonName column will be used as the display name</li>
          <li>Physical units will be auto-derived from Packaging column</li>
          <li>Stock levels will be set to 50% of UnitsPerCase by default</li>
          <li>All items will start with zero current stock</li>
        </ul>
      </div>
    }

    @if (csvData().length && !isImporting()) {
      <!-- Preview Section -->
      <div class="preview-section">
        <h4>Import Preview ({{csvData().length}} items)</h4>
        <p>Review the items below before importing:</p>
        
        <div class="preview-table-container">
          <table mat-table [dataSource]="previewData()" class="preview-table">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Item Name</th>
              <td mat-cell *matCellDef="let item">{{item.CommonName || item.VendorProductDescriptionOrName}}</td>
            </ng-container>

            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef>Category</th>
              <td mat-cell *matCellDef="let item">{{item.ItemCategory}}</td>
            </ng-container>

            <ng-container matColumnDef="vendor">
              <th mat-header-cell *matHeaderCellDef>Vendor</th>
              <td mat-cell *matCellDef="let item">{{item.Vendor}}</td>
            </ng-container>

            <ng-container matColumnDef="cost">
              <th mat-header-cell *matHeaderCellDef>Cost Per Case</th>
              <td mat-cell *matCellDef="let item">{{item.CostPerCase}}</td>
            </ng-container>

            <ng-container matColumnDef="packaging">
              <th mat-header-cell *matHeaderCellDef>Packaging</th>
              <td mat-cell *matCellDef="let item">{{item.Packaging}}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="previewColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: previewColumns;"></tr>
          </table>
        </div>
      </div>
    }

    @if (isImporting()) {
      <!-- Import Progress Section -->
      <div class="progress-section">
        <h4>Importing Inventory Items...</h4>
        
        <div class="progress-info">
          <p>Processing: {{importProgress().current}}</p>
          <p>Progress: {{importProgress().completed}} of {{importProgress().total}} items</p>
          @if (importProgress().failed > 0) {
            <p class="error-text">Failed: {{importProgress().failed}} items</p>
          }
        </div>

        <mat-progress-bar 
          mode="determinate" 
          [value]="(importProgress().completed / importProgress().total) * 100">
        </mat-progress-bar>
      </div>
    }

  </div>

  <!-- Dialog Actions -->
  <div mat-dialog-actions class="dialog-actions">
    <button 
      type="button"
      mat-button 
      (click)="onCancel()"
      [disabled]="isImporting()">
      Cancel
    </button>

    @if (csvData().length && !isImporting()) {
      <button 
        type="button"
        mat-button
        (click)="onReset()">
        <mat-icon>refresh</mat-icon>
        Choose Different File
      </button>

      <button 
        type="button"
        mat-raised-button 
        color="primary"
        (click)="onImport()">
        <mat-icon>cloud_upload</mat-icon>
        Import {{csvData().length}} Items
      </button>
    }

    @if (isImporting()) {
      <button 
        type="button"
        mat-raised-button 
        color="primary"
        disabled>
        <mat-icon>hourglass_empty</mat-icon>
        Importing...
      </button>
    }
  </div>

</div>